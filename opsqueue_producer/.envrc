# First, make sure the higher-level .envrc is loaded
# Note that all dependency management, including installing maturin itself,
# is actually done through nix in this top level .envrc
source_up

# Then, we (create iff necessary) and activate an (empty!) virtual env
# so Maturin doesn't complain when running `maturin develop`.
if [ ! -d ".venv" ]; then
  echo "Creating an empty Python virtualenv to be able to run 'maturin develop'."
  python -m venv .venv
  echo "Done!"
fi

source .venv/bin/activate
